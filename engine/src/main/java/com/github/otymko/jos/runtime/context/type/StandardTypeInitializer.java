/*
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */
package com.github.otymko.jos.runtime.context.type;

import com.github.otymko.jos.runtime.context.type.collection.V8Array;
import com.github.otymko.jos.runtime.context.type.collection.V8FixedArray;
import com.github.otymko.jos.runtime.context.type.collection.V8FixedMap;
import com.github.otymko.jos.runtime.context.type.collection.V8FixedStructure;
import com.github.otymko.jos.runtime.context.type.collection.V8KeyAndValue;
import com.github.otymko.jos.runtime.context.type.collection.V8Map;
import com.github.otymko.jos.runtime.context.type.collection.V8Structure;
import com.github.otymko.jos.runtime.context.type.collection.V8ValueTable;
import com.github.otymko.jos.runtime.context.type.common.V8RandomNumberGenerator;
import com.github.otymko.jos.runtime.context.type.common.V8CompareValues;
import com.github.otymko.jos.runtime.context.type.file.V8File;
import com.github.otymko.jos.runtime.context.type.primitive.BooleanValue;
import com.github.otymko.jos.runtime.context.type.primitive.DateValue;
import com.github.otymko.jos.runtime.context.type.primitive.NullValue;
import com.github.otymko.jos.runtime.context.type.primitive.NumberValue;
import com.github.otymko.jos.runtime.context.type.primitive.StringValue;
import com.github.otymko.jos.runtime.context.type.primitive.TypeValue;
import com.github.otymko.jos.runtime.context.type.primitive.UndefinedValue;
import com.github.otymko.jos.runtime.context.type.regex.Regex;
import com.github.otymko.jos.runtime.context.type.typedescription.BinaryDataQualifiers;
import com.github.otymko.jos.runtime.context.type.typedescription.DateQualifiers;
import com.github.otymko.jos.runtime.context.type.typedescription.NumberQualifiers;
import com.github.otymko.jos.runtime.context.type.typedescription.StringQualifiers;
import com.github.otymko.jos.runtime.context.type.typedescription.TypeDescription;
import com.github.otymko.jos.runtime.machine.info.ContextInfo;
import lombok.experimental.UtilityClass;

@UtilityClass
public class StandardTypeInitializer {
    /**
     * Инициализацировать стандартные типы.
     *
     * @param typeManager Менеджер типов.
     */
    public void initialize(TypeManager typeManager) {
        initPrimitives(typeManager);
        initSystemEnumerations(typeManager);
        initCollections(typeManager);
    }

    private void initPrimitives(TypeManager typeManager) {
        for (var type : DataType.values()) {

            if (type == DataType.UNDEFINED) {
                implementTypeByInfo(typeManager, UndefinedValue.INFO);
            } else if (type == DataType.GENERIC_VALUE) {
                implementTypeByInfo(typeManager, NullValue.INFO);
            } else if (type == DataType.BOOLEAN) {
                implementTypeByInfo(typeManager, BooleanValue.INFO);
            } else if (type == DataType.STRING) {
                implementTypeByInfo(typeManager, StringValue.INFO);
            } else if (type == DataType.NUMBER) {
                implementTypeByInfo(typeManager, NumberValue.INFO);
            } else if (type == DataType.DATE) {
                implementTypeByInfo(typeManager, DateValue.INFO);
            } else if (type == DataType.TYPE) {
                implementTypeByInfo(typeManager, TypeValue.INFO);
            }
            // object
            // + алиас?
        }
    }

    private void implementTypeByInfo(TypeManager typeManager, ContextInfo info) {
        typeManager.registerType(info.getName(), info);
        typeManager.registerType(info.getAlias(), info);
    }

    private void initCollections(TypeManager typeManager) {
        // TODO: name и alias из contextType
        implementTypeByInfo(typeManager, V8Array.INFO);
        implementTypeByInfo(typeManager, V8FixedArray.INFO);
        implementTypeByInfo(typeManager, V8KeyAndValue.INFO);
        implementTypeByInfo(typeManager, V8Structure.INFO);
        implementTypeByInfo(typeManager, V8FixedStructure.INFO);
        implementTypeByInfo(typeManager, V8Map.INFO);
        implementTypeByInfo(typeManager, V8FixedMap.INFO);

        implementTypeByInfo(typeManager, BinaryDataQualifiers.INFO);
        implementTypeByInfo(typeManager, DateQualifiers.INFO);
        implementTypeByInfo(typeManager, NumberQualifiers.INFO);
        implementTypeByInfo(typeManager, StringQualifiers.INFO);
        implementTypeByInfo(typeManager, TypeDescription.INFO);

        implementTypeByInfo(typeManager, Regex.INFO);
        implementTypeByInfo(typeManager, V8File.INFO);
        implementTypeByInfo(typeManager, V8RandomNumberGenerator.INFO);

        implementTypeByInfo(typeManager, V8ValueTable.INFO);
        implementTypeByInfo(typeManager, V8CompareValues.INFO);
    }

    private void initSystemEnumerations(TypeManager typeManager) {
        typeManager.getEnumerationContext().forEach(context -> implementTypeByInfo(typeManager, context.getContextInfo()));
    }
}
